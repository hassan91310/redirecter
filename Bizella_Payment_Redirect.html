<!DOCTYPE html>
<html>
<head>
    <title>Payment Redirect</title>
</head>
<body>
    <script>
        function getReferences() {
            const urlParams = new URLSearchParams(window.location.search);
            console.log("Raw URL Params:", urlParams.toString());

            const transactionReference = urlParams.get('reference'); 
            const bookingReference = urlParams.get('bookingReference');

            // Existing optional parameters
            const promoInUserPromoFound = urlParams.get('promoInUserPromoFound') === "true";
            const promoUsed = urlParams.get('promoUsed') === "true";
            const userPromoReference = urlParams.get('userPromoReference') || null;
            const promoCodeReference = urlParams.get('promoCodeReference') || null;
            const voucherChange = urlParams.get('voucherChange') || null;

            // ✅ BizCoins used
            const bizcoinUsed = parseFloat(urlParams.get('bizcoinUsed')) || 0.0;

            // ✅ New parameters
            const paymentFor = urlParams.get('paymentFor') || null;
            const addon = urlParams.get('addon') || null;

            console.log("Transaction Reference:", transactionReference);
            console.log("Booking Reference:", bookingReference);
            console.log("Promo In User Promo Found:", promoInUserPromoFound);
            console.log("Promo Used:", promoUsed);
            console.log("User Promo Reference:", userPromoReference);
            console.log("Promo Code Reference:", promoCodeReference);
            console.log("Voucher Change:", voucherChange);
            console.log("BizCoin Used:", bizcoinUsed);
            console.log("Payment For:", paymentFor);
            console.log("Addon:", addon);

            return { 
                transactionReference, 
                bookingReference, 
                promoInUserPromoFound, 
                promoUsed, 
                userPromoReference, 
                promoCodeReference,
                voucherChange,
                bizcoinUsed,
                paymentFor,
                addon
            };
        }

        function redirectToDeepLink() {
            const { 
                transactionReference, 
                bookingReference, 
                promoInUserPromoFound, 
                promoUsed, 
                userPromoReference, 
                promoCodeReference,
                voucherChange,
                bizcoinUsed,
                paymentFor,
                addon
            } = getReferences();

            if (transactionReference) {
                const deepLink = `bizella://bizella.com/customerBookingConfirmedOage?transactionReference=${encodeURIComponent(transactionReference)}&bookingReference=${encodeURIComponent(bookingReference || '')}&promoInUserPromoFound=${promoInUserPromoFound}&promoUsed=${promoUsed}&userPromoReference=${encodeURIComponent(userPromoReference || '')}&promoCodeReference=${encodeURIComponent(promoCodeReference || '')}&voucherChange=${encodeURIComponent(voucherChange || '')}&bizcoinUsed=${bizcoinUsed}&paymentFor=${encodeURIComponent(paymentFor || '')}&addon=${encodeURIComponent(addon || '')}`;

                console.log("Redirecting to:", deepLink);
                window.location.href = deepLink;
            } else {
                console.error("One or both references not found.");
                alert("One or both references not found.");
            }
        }

        redirectToDeepLink();
    </script>
</body>
</html>


<!-- <!DOCTYPE html>
<html>
<head>
    <title>Payment Redirect</title>
</head>
<body>
    <script>
        function getReferences() {
            const urlParams = new URLSearchParams(window.location.search);
            console.log("Raw URL Params:", urlParams.toString());

            const transactionReference = urlParams.get('reference'); 
            const bookingReference = urlParams.get('bookingReference');

            // Existing optional parameters
            const promoInUserPromoFound = urlParams.get('promoInUserPromoFound') === "true";
            const promoUsed = urlParams.get('promoUsed') === "true";
            const userPromoReference = urlParams.get('userPromoReference') || null;
            const promoCodeReference = urlParams.get('promoCodeReference') || null;
            const voucherChange = urlParams.get('voucherChange') || null;

            // ✅ New parameter for BizCoins used
            const bizcoinUsed = parseFloat(urlParams.get('bizcoinUsed')) || 0.0;

            console.log("Transaction Reference:", transactionReference);
            console.log("Booking Reference:", bookingReference);
            console.log("Promo In User Promo Found:", promoInUserPromoFound);
            console.log("Promo Used:", promoUsed);
            console.log("User Promo Reference:", userPromoReference);
            console.log("Promo Code Reference:", promoCodeReference);
            console.log("Voucher Change:", voucherChange);
            console.log("BizCoin Used:", bizcoinUsed);

            return { 
                transactionReference, 
                bookingReference, 
                promoInUserPromoFound, 
                promoUsed, 
                userPromoReference, 
                promoCodeReference,
                voucherChange,
                bizcoinUsed
            };
        }

        function redirectToDeepLink() {
            const { 
                transactionReference, 
                bookingReference, 
                promoInUserPromoFound, 
                promoUsed, 
                userPromoReference, 
                promoCodeReference,
                voucherChange,
                bizcoinUsed
            } = getReferences();

            if (transactionReference) {
                const deepLink = `bizella://bizella.com/customerBookingConfirmedOage?transactionReference=${encodeURIComponent(transactionReference)}&bookingReference=${encodeURIComponent(bookingReference || '')}&promoInUserPromoFound=${promoInUserPromoFound}&promoUsed=${promoUsed}&userPromoReference=${encodeURIComponent(userPromoReference || '')}&promoCodeReference=${encodeURIComponent(promoCodeReference || '')}&voucherChange=${encodeURIComponent(voucherChange || '')}&bizcoinUsed=${bizcoinUsed}`;

                console.log("Redirecting to:", deepLink);
                window.location.href = deepLink;
            } else {
                console.error("One or both references not found.");
                alert("One or both references not found.");
            }
        }

        redirectToDeepLink();
    </script>
</body>
</html> -->
